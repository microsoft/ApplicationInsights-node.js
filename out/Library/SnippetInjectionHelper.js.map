{"version":3,"file":"SnippetInjectionHelper.js","sourceRoot":"","sources":["../../Library/SnippetInjectionHelper.ts"],"names":[],"mappings":"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","sourcesContent":["import zlib = require(\"zlib\");\nimport { promisify } from \"util\";\nimport http = require(\"http\");\n\n// currently support the following encoding types\nexport enum contentEncodingMethod {\n    GZIP = \"gzip\",\n    DEFLATE = \"deflate\",\n    BR = \"br\"\n}\n\n//current supported encoding types\nexport const bufferEncodingTypes = [\"utf8\",\"utf16le\",\"latin1\",\"base64\",\"hex\",\"ascii\",\"binary\",\"ucs2\"];\n\n//for node version under 10, Brotli compression is not supported.\nexport const isBrotliSupperted = (): boolean => {\n    const majVer = process.versions.node.split(\".\")[0];\n    return parseInt(majVer) >= 10;\n}\n\nexport const gzipAsync = promisify(zlib.gzip);\nexport const gunzipAsync = promisify(zlib.gunzip);\nexport const deflateAsync = promisify(zlib.deflate);\nexport const inflateAsync = promisify(zlib.inflate);\n\nexport const getBrotliCompressAsync = (zlibObject: any): Function => {\n    let isMajorVer = isBrotliSupperted();\n    if (isMajorVer && typeof zlibObject.brotliCompress === \"function\") {\n        return promisify(zlibObject.brotliCompress);\n    }\n    return null;\n}\n\nexport const getBrotliCompressSync = (zlibObject: any): Function => {\n    let isMajorVer = isBrotliSupperted();\n    if (isMajorVer && typeof zlibObject.brotliCompressSync === \"function\") {\n        return zlibObject.brotliCompressSync;\n    }\n    return null;\n}\n\nexport const getBrotliDecompressAsync = (zlibObject: any): Function => {\n    let isMajorVer = isBrotliSupperted();\n    if (isMajorVer && typeof zlibObject.brotliDecompress === \"function\") {\n        return promisify(zlibObject.brotliDecompress);\n    }\n    return null;\n}\n\nexport const getBrotliDecompressSync = (zlibObject: any): Function => {\n    let isMajorVer = isBrotliSupperted();\n    if (isMajorVer && typeof zlibObject.brotliDecompressSync === \"function\") {\n        return zlibObject.brotliDecompressSync;\n    }\n    return null;\n}\n\nexport const isBufferType = (buffer: Buffer, type?:string): boolean => {\n    let encodingType = type? type:\"utf8\";\n    let result = false;\n    if (Buffer.isEncoding(encodingType)) {\n        let newBuffer = Buffer.from(buffer.toString(encodingType),encodingType);\n        result = newBuffer.toJSON().data.toString() === buffer.toJSON().data.toString();\n    }\n    \n    return result;\n}\n\nexport const findBufferEncodingType = (buffer: Buffer): string =>  {\n    let bufferType = null;\n    for (let key in bufferEncodingTypes) {\n        let type = bufferEncodingTypes[key]\n        if (Buffer.isEncoding(type) && isBufferType(buffer, type) ) {\n            bufferType = type;\n            break;\n        }\n    }\n    return bufferType;\n}\n\nexport const isSupportedContentEncoding = (encodingMethod: string): contentEncodingMethod => {\n    let encodingType = null;\n    switch (encodingMethod) {\n        case \"gzip\":\n            encodingType = contentEncodingMethod.GZIP;\n            break;\n        case \"br\":\n            encodingType = contentEncodingMethod.BR;\n            break;\n        case \"deflate\":\n            encodingType = contentEncodingMethod.DEFLATE;\n            break;\n        default:\n    }\n    return encodingType;\n}\n\n// mutiple content-encoding is not supported\n// for mutiple content-encoding, this method will return any empty array\nexport const getContentEncodingFromHeaders = (response: http.ServerResponse): contentEncodingMethod[] => {\n    let headers: contentEncodingMethod[] = [];\n    let contentEncodingHeaders = response.getHeader(\"Content-Encoding\");\n    if (!contentEncodingHeaders) return null;\n    if (typeof contentEncodingHeaders === \"string\") {\n        let supportedContentEncoding = isSupportedContentEncoding(contentEncodingHeaders);\n        if (supportedContentEncoding) { headers.push(supportedContentEncoding); }\n    }\n    return headers;\n}\n\nexport const insertSnippetByIndex = (index: number, html: string, snippet: string): string => {\n    if (index < 0) return null;\n    let newHtml = null;\n    let subStart = html.substring(0, index);\n    let subEnd = html.substring(index);\n    newHtml = subStart + \"<script type=\\\"text/javascript\\\">\" + snippet + \"</script>\" + subEnd;\n    return newHtml;\n}\n\nexport const isContentTypeHeaderHtml = (response: http.ServerResponse): boolean => {\n    let isHtml = false;\n    let contentType = response.getHeader(\"Content-Type\");\n    if (contentType) {\n        if (typeof contentType === \"string\") {\n            isHtml = contentType.indexOf(\"html\") >= 0;\n        } else {\n            isHtml = contentType.toString().indexOf(\"html\") >= 0;\n        }\n    }\n    return isHtml;\n}\n\n"]}