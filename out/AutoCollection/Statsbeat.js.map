{"version":3,"file":"Statsbeat.js","sourceRoot":"","sources":["../../AutoCollection/Statsbeat.ts"],"names":[],"mappings":"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","sourcesContent":["import os = require(\"os\");\nimport EnvelopeFactory = require(\"../Library/EnvelopeFactory\");\nimport Logging = require(\"../Library/Logging\");\nimport Sender = require(\"../Library/Sender\");\nimport Constants = require(\"../Declarations/Constants\");\nimport Contracts = require(\"../Declarations/Contracts\");\nimport Vm = require(\"../Library/AzureVirtualMachine\");\nimport Config = require(\"../Library/Config\");\nimport Context = require(\"../Library/Context\");\nimport Network = require(\"./NetworkStatsbeat\");\nimport Util = require(\"../Library/Util\");\n\nconst STATSBEAT_LANGUAGE = \"node\";\n\nclass Statsbeat {\n\n    public static NON_EU_CONNECTION_STRING = \"InstrumentationKey=c4a29126-a7cb-47e5-b348-11414998b11e;IngestionEndpoint=https://westus-0.in.applicationinsights.azure.com\";\n    public static EU_CONNECTION_STRING = \"InstrumentationKey=7dc56bab-3c0c-4e9f-9ebb-d1acadee8d0f;IngestionEndpoint=https://westeurope-5.in.applicationinsights.azure.com\";\n    public static STATS_COLLECTION_SHORT_INTERVAL: number = 900000; // 15 minutes\n    public static STATS_COLLECTION_LONG_INTERVAL: number = 86400000; // 1 day\n\n    private static TAG = \"Statsbeat\";\n\n    private _networkStatsbeatCollection: Array<Network.NetworkStatsbeat>;\n    private _sender: Sender;\n    private _context: Context;\n    private _handle: NodeJS.Timer | null;\n    private _longHandle: NodeJS.Timer | null;\n    private _isEnabled: boolean;\n    private _isInitialized: boolean;\n    private _config: Config;\n    private _statsbeatConfig: Config;\n    private _isVM: boolean | undefined;\n    private _statbeatMetrics: Array<{ name: string; value: number, properties: {} }>;\n\n    // Custom dimensions\n    private _resourceProvider: string;\n    private _resourceIdentifier: string;\n    private _sdkVersion: string;\n    private _runtimeVersion: string;\n    private _os: string;\n    private _language: string;\n    private _cikey: string;\n    private _attach: string = Constants.StatsbeatAttach.sdk; // Default is SDK\n    private _feature: number = Constants.StatsbeatFeature.NONE;\n    private _instrumentation: number = Constants.StatsbeatInstrumentation.NONE;\n\n    constructor(config: Config, context?: Context) {\n        this._isInitialized = false;\n        this._statbeatMetrics = [];\n        this._networkStatsbeatCollection = [];\n        this._config = config;\n        this._context = context || new Context();\n        let statsbeatConnectionString = this._getConnectionString(config);\n        this._statsbeatConfig = new Config(statsbeatConnectionString);\n        this._statsbeatConfig.samplingPercentage = 100; // Do not sample\n        this._sender = new Sender(this._statsbeatConfig, null, null, null, null, true, this._shutdownStatsbeat.bind(this));\n    }\n\n    public enable(isEnabled: boolean) {\n        this._isEnabled = isEnabled;\n        if (this._isEnabled && !this._isInitialized) {\n            this._getCustomProperties();\n            this._isInitialized = true;\n        }\n        if (isEnabled) {\n            if (!this._handle) {\n                this._handle = setInterval(() => {\n                    this.trackShortIntervalStatsbeats();\n                }, Statsbeat.STATS_COLLECTION_SHORT_INTERVAL);\n                this._handle.unref(); // Allow the app to terminate even while this loop is going on\n            }\n            if (!this._longHandle) {\n                // On first enablement\n                this.trackLongIntervalStatsbeats();\n                this._longHandle = setInterval(() => {\n                    this.trackLongIntervalStatsbeats();\n                }, Statsbeat.STATS_COLLECTION_LONG_INTERVAL);\n                this._longHandle.unref(); // Allow the app to terminate even while this loop is going on\n            }\n        } else {\n            if (this._handle) {\n                clearInterval(this._handle);\n                this._handle = null;\n            }\n            if (this._longHandle) {\n                clearInterval(this._longHandle);\n                this._longHandle = null;\n            }\n        }\n    }\n\n    public isInitialized() {\n        return this._isInitialized;\n    }\n\n    public isEnabled() {\n        return this._isEnabled;\n    }\n\n    public setCodelessAttach() {\n        this._attach = Constants.StatsbeatAttach.codeless;\n    }\n\n    public addFeature(feature: Constants.StatsbeatFeature) {\n        this._feature |= feature;\n    }\n\n    public removeFeature(feature: Constants.StatsbeatFeature) {\n        this._feature &= ~feature;\n    }\n\n    public addInstrumentation(instrumentation: Constants.StatsbeatInstrumentation) {\n        this._instrumentation |= instrumentation;\n    }\n\n    public removeInstrumentation(instrumentation: Constants.StatsbeatInstrumentation) {\n        this._instrumentation &= ~instrumentation;\n    }\n\n    public countRequest(endpoint: number, host: string, duration: number, success: boolean, statusCode?: number) {\n        if (!this.isEnabled()) {\n            return;\n        }\n        let counter: Network.NetworkStatsbeat = this._getNetworkStatsbeatCounter(endpoint, host);\n        counter.totalRequestCount++;\n        counter.intervalRequestExecutionTime += duration;\n        if (success === false) {\n            if (!statusCode) {\n                return;\n            }\n            let currentStatusCounter = counter.totalFailedRequestCount.find((statusCounter) => statusCode === statusCounter.statusCode);\n            if (currentStatusCounter) {\n                currentStatusCounter.count++;\n            } else {\n                counter.totalFailedRequestCount.push({ statusCode: statusCode, count: 1 });\n            }\n        }\n        else {\n            counter.totalSuccesfulRequestCount++;\n        }\n    }\n\n    public countException(endpoint: number, host: string, exceptionType: Error) {\n        if (!this.isEnabled()) {\n            return;\n        }\n        let counter: Network.NetworkStatsbeat = this._getNetworkStatsbeatCounter(endpoint, host);\n        let currentErrorCounter = counter.exceptionCount.find((exceptionCounter) => exceptionType.name === exceptionCounter.exceptionType);\n        if (currentErrorCounter) {\n            currentErrorCounter.count++;\n        } else {\n            counter.exceptionCount.push({ exceptionType: exceptionType.name, count: 1 });\n        }\n    }\n\n    public countThrottle(endpoint: number, host: string, statusCode: number) {\n        if (!this.isEnabled()) {\n            return;\n        }\n        let counter: Network.NetworkStatsbeat = this._getNetworkStatsbeatCounter(endpoint, host);\n        let currentStatusCounter = counter.throttleCount.find((statusCounter) => statusCode === statusCounter.statusCode);\n        if (currentStatusCounter) {\n            currentStatusCounter.count++;\n        } else {\n            counter.throttleCount.push({ statusCode: statusCode, count: 1 });\n        }\n    }\n\n    public countRetry(endpoint: number, host: string, statusCode: number) {\n        if (!this.isEnabled()) {\n            return;\n        }\n        let counter: Network.NetworkStatsbeat = this._getNetworkStatsbeatCounter(endpoint, host);\n        let currentStatusCounter = counter.retryCount.find((statusCounter) => statusCode === statusCounter.statusCode);\n        if (currentStatusCounter) {\n            currentStatusCounter.count++;\n        } else {\n            counter.retryCount.push({ statusCode: statusCode, count: 1 });\n        }\n    }\n\n    public async trackShortIntervalStatsbeats() {\n        try {\n            await this._getResourceProvider();\n            let networkProperties = {\n                \"os\": this._os,\n                \"rp\": this._resourceProvider,\n                \"cikey\": this._cikey,\n                \"runtimeVersion\": this._runtimeVersion,\n                \"language\": this._language,\n                \"version\": this._sdkVersion,\n                \"attach\": this._attach\n            }\n            this._trackRequestDuration(networkProperties);\n            this._trackRequestsCount(networkProperties);\n            await this._sendStatsbeats();\n        }\n        catch (error) {\n            Logging.info(Statsbeat.TAG, \"Failed to send Statsbeat metrics: \" + Util.dumpObj(error));\n        }\n    }\n\n    public async trackLongIntervalStatsbeats() {\n        try {\n            await this._getResourceProvider();\n            let commonProperties = {\n                \"os\": this._os,\n                \"rp\": this._resourceProvider,\n                \"cikey\": this._cikey,\n                \"runtimeVersion\": this._runtimeVersion,\n                \"language\": this._language,\n                \"version\": this._sdkVersion,\n                \"attach\": this._attach\n            };\n            let attachProperties = Object.assign({\n                \"rpId\": this._resourceIdentifier\n            }, commonProperties);\n            this._statbeatMetrics.push({ name: Constants.StatsbeatCounter.ATTACH, value: 1, properties: attachProperties });\n            if (this._instrumentation != Constants.StatsbeatInstrumentation.NONE) {// Only send if there are some instrumentations enabled\n                let instrumentationProperties = Object.assign({ \"feature\": this._instrumentation, \"type\": Constants.StatsbeatFeatureType.Instrumentation }, commonProperties);\n                this._statbeatMetrics.push({ name: Constants.StatsbeatCounter.FEATURE, value: 1, properties: instrumentationProperties });\n            }\n            if (this._feature != Constants.StatsbeatFeature.NONE) {// Only send if there are some features enabled\n                let featureProperties = Object.assign({ \"feature\": this._feature, \"type\": Constants.StatsbeatFeatureType.Feature }, commonProperties);\n                this._statbeatMetrics.push({ name: Constants.StatsbeatCounter.FEATURE, value: 1, properties: featureProperties });\n            }\n            await this._sendStatsbeats();\n        }\n        catch (error) {\n            Logging.info(Statsbeat.TAG, \"Failed to send Statsbeat metrics: \" + Util.dumpObj(error));\n        }\n    }\n\n    private _getNetworkStatsbeatCounter(endpoint: number, host: string): Network.NetworkStatsbeat {\n        let shortHost = this._getShortHost(host);\n        // Check if counter is available\n        for (let i = 0; i < this._networkStatsbeatCollection.length; i++) {\n            // Same object\n            if (endpoint === this._networkStatsbeatCollection[i].endpoint &&\n                shortHost === this._networkStatsbeatCollection[i].host) {\n                return this._networkStatsbeatCollection[i];\n            }\n        }\n        // Create a new one if not found\n        let newCounter = new Network.NetworkStatsbeat(endpoint, shortHost);\n        this._networkStatsbeatCollection.push(newCounter);\n        return newCounter;\n    }\n\n    private _trackRequestDuration(commonProperties: {}) {\n        for (let i = 0; i < this._networkStatsbeatCollection.length; i++) {\n            let currentCounter = this._networkStatsbeatCollection[i];\n            currentCounter.time = +new Date;\n            let intervalRequests = (currentCounter.totalRequestCount - currentCounter.lastRequestCount) || 0;\n            let totalRequestExecutionTime = currentCounter.intervalRequestExecutionTime - currentCounter.lastIntervalRequestExecutionTime;\n            let averageRequestExecutionTime = totalRequestExecutionTime > 0 ? (totalRequestExecutionTime / intervalRequests) || 0 : 0;\n            currentCounter.lastIntervalRequestExecutionTime = currentCounter.intervalRequestExecutionTime; // reset\n            if (intervalRequests > 0) {\n                // Add extra properties\n                let properties = Object.assign(\n                    {\n                        \"endpoint\": this._networkStatsbeatCollection[i].endpoint,\n                        \"host\": this._networkStatsbeatCollection[i].host\n                    },\n                    commonProperties\n                );\n                this._statbeatMetrics.push({\n                    name: Constants.StatsbeatCounter.REQUEST_DURATION,\n                    value: averageRequestExecutionTime,\n                    properties: properties\n                });\n            }\n            // Set last counters\n            currentCounter.lastRequestCount = currentCounter.totalRequestCount;\n            currentCounter.lastTime = currentCounter.time;\n        }\n    }\n\n    private _getShortHost(originalHost: string) {\n        let shortHost = originalHost;\n        try {\n            let hostRegex = new RegExp(/^https?:\\/\\/(?:www\\.)?([^\\/.-]+)/);\n            let res = hostRegex.exec(originalHost);\n            if (res != null && res.length > 1) {\n                shortHost = res[1];\n            }\n            shortHost = shortHost.replace(\".in.applicationinsights.azure.com\", \"\");\n        }\n        catch (error) {\n            // Ignore error\n        }\n        return shortHost;\n    }\n\n    private _trackRequestsCount(commonProperties: {}) {\n        for (let i = 0; i < this._networkStatsbeatCollection.length; i++) {\n            var currentCounter = this._networkStatsbeatCollection[i];\n            let properties = Object.assign(\n                { \"endpoint\": currentCounter.endpoint, \"host\": currentCounter.host },\n                commonProperties\n            );\n            if (currentCounter.totalSuccesfulRequestCount > 0) {\n                this._statbeatMetrics.push({\n                        name: Constants.StatsbeatCounter.REQUEST_SUCCESS,\n                        value: currentCounter.totalSuccesfulRequestCount,\n                        properties: properties\n                });\n                currentCounter.totalSuccesfulRequestCount = 0; //Reset\n            }\n            if (currentCounter.totalFailedRequestCount.length > 0) {\n                currentCounter.totalFailedRequestCount.forEach((currentCounter) => {\n                    properties = Object.assign({ ...properties, \"statusCode\": currentCounter.statusCode });\n                    this._statbeatMetrics.push({\n                        name: Constants.StatsbeatCounter.REQUEST_FAILURE,\n                        value: currentCounter.count,\n                        properties: properties\n                    });\n                });\n                currentCounter.totalFailedRequestCount = []; //Reset\n            }\n            if (currentCounter.retryCount.length > 0) {\n                currentCounter.retryCount.forEach((currentCounter) => {\n                    properties = Object.assign({ ...properties, \"statusCode\": currentCounter.statusCode });\n                    this._statbeatMetrics.push({\n                        name: Constants.StatsbeatCounter.RETRY_COUNT,\n                        value: currentCounter.count,\n                        properties: properties\n                    });\n                });\n                currentCounter.retryCount = []; //Reset\n            }\n            if (currentCounter.throttleCount.length > 0) {\n                currentCounter.throttleCount.forEach((currentCounter) => {\n                    properties = Object.assign({ ...properties, \"statusCode\": currentCounter.statusCode });\n                    this._statbeatMetrics.push({\n                        name: Constants.StatsbeatCounter.THROTTLE_COUNT,\n                        value: currentCounter.count,\n                        properties: properties\n                    });\n                });\n                currentCounter.throttleCount = []; //Reset\n            }\n            if (currentCounter.exceptionCount.length > 0) {\n                currentCounter.exceptionCount.forEach((currentCounter) => {\n                    properties = Object.assign({ ...properties, \"exceptionType\": currentCounter.exceptionType });\n                    this._statbeatMetrics.push({\n                        name: Constants.StatsbeatCounter.EXCEPTION_COUNT,\n                        value: currentCounter.count,\n                        properties: properties\n                    });\n                });\n                currentCounter.exceptionCount = []; //Reset\n            }\n        }\n    }\n\n    private async _sendStatsbeats() {\n        let envelopes: Array<Contracts.Envelope> = [];\n        for (let i = 0; i < this._statbeatMetrics.length; i++) {\n            let statsbeat: Contracts.MetricTelemetry = {\n                name: this._statbeatMetrics[i].name,\n                value: this._statbeatMetrics[i].value,\n                properties: this._statbeatMetrics[i].properties\n            };\n            let envelope = EnvelopeFactory.createEnvelope(statsbeat, Contracts.TelemetryType.Metric, null, this._context, this._statsbeatConfig);\n            envelope.name = Constants.StatsbeatTelemetryName;\n            envelopes.push(envelope);\n        }\n        this._statbeatMetrics = [];\n        await this._sender.send(envelopes);\n    }\n\n    private _getCustomProperties() {\n        this._language = STATSBEAT_LANGUAGE;\n        this._cikey = this._config.instrumentationKey;\n        this._sdkVersion = Context.sdkVersion; // \"node\" or \"node-nativeperf\"\n        this._os = os.type();\n        this._runtimeVersion = process.version;\n    }\n\n    private _getResourceProvider(): Promise<void> {\n        return new Promise((resolve, reject) => {\n            // Check resource provider\n            let waiting: boolean = false;\n            this._resourceProvider = Constants.StatsbeatResourceProvider.unknown;\n            this._resourceIdentifier = Constants.StatsbeatResourceProvider.unknown;\n            if (process.env.WEBSITE_SITE_NAME) { // Web apps\n                this._resourceProvider = Constants.StatsbeatResourceProvider.appsvc;\n                this._resourceIdentifier = process.env.WEBSITE_SITE_NAME;\n                if (process.env.WEBSITE_HOME_STAMPNAME) {\n                    this._resourceIdentifier += \"/\" + process.env.WEBSITE_HOME_STAMPNAME;\n                }\n            } else if (process.env.FUNCTIONS_WORKER_RUNTIME) { // Function apps\n                this._resourceProvider = Constants.StatsbeatResourceProvider.functions;\n                if (process.env.WEBSITE_HOSTNAME) {\n                    this._resourceIdentifier = process.env.WEBSITE_HOSTNAME;\n                }\n            } else if (this._config) {\n                if (this._isVM === undefined || this._isVM == true) {\n                    waiting = true;\n                    Vm.AzureVirtualMachine.getAzureComputeMetadata(this._config, (vmInfo) => {\n                        this._isVM = vmInfo.isVM;\n                        if (this._isVM) {\n                            this._resourceProvider = Constants.StatsbeatResourceProvider.vm;\n                            this._resourceIdentifier = vmInfo.id + \"/\" + vmInfo.subscriptionId;\n                            // Override OS as VM info have higher precedence\n                            if (vmInfo.osType) {\n                                this._os = vmInfo.osType;\n                            }\n                        }\n                        resolve();\n                    });\n                } else {\n                    this._resourceProvider = Constants.StatsbeatResourceProvider.unknown;\n                }\n            }\n            if (!waiting) {\n                resolve();\n            }\n        });\n    }\n\n    private _shutdownStatsbeat() {\n        this.enable(false);// Disable Statsbeat as is it failed 3 times cosnecutively during initialization, is possible SDK is running in private or restricted network\n    }\n\n    private _getConnectionString(config: Config): string {\n        let currentEndpoint = config.endpointUrl;\n        let euEndpoints = [\n            \"westeurope\",\n            \"northeurope\",\n            \"francecentral\",\n            \"francesouth\",\n            \"germanywestcentral\",\n            \"norwayeast\",\n            \"norwaywest\",\n            \"swedencentral\",\n            \"switzerlandnorth\",\n            \"switzerlandwest\",\n            \"uksouth\",\n            \"ukwest\"\n        ];\n        for (let i = 0; i < euEndpoints.length; i++) {\n            if (currentEndpoint.indexOf(euEndpoints[i]) > -1) {\n                return Statsbeat.EU_CONNECTION_STRING;\n            }\n        }\n        return Statsbeat.NON_EU_CONNECTION_STRING;\n    }\n}\n\nexport = Statsbeat;\n"]}